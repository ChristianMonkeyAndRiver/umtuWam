<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>UmtuWam</title>
    <link rel="stylesheet" href="./Startup.css" type="text/css">
</head>

<body>
    <script>
        window.onload = function () {
            id.setAttribute("value", new URL(location.href).searchParams.get("did"));
        }

        function validateThis() {
            var checkboxes = document.getElementsByName("lookingFor");
            var okay = false;
            for (var i = 0, l = checkboxes.length; i < l; i++) {
                if (checkboxes[i].checked) {
                    okay = true;
                    break;
                }
            }
            if (!okay) {
                lookingForError.removeAttribute("hidden");
                return false;
            } else {
                lookingForError.setAttribute("hidden", true);
                return true;
            }
        }

        function stop() {
            event.preventDefault();
            var test = validateThis();

            if (test) {
                var gender = "";
                var inputs = document.getElementsByName("gender");
                for (var i = 0; i < inputs.length; i++) {
                    if (inputs[i].checked) {
                        gender = inputs[i].value;
                    }
                }

                var lookingForMale = false;
                var lookingForFemale = false;
                inputs = document.getElementsByName("lookingFor");
                for (var i = 0; i < inputs.length; i++) {
                    if (inputs[i].checked) {
                        if (inputs[i].value == "Female") {
                            lookingForFemale = true;
                        }
                        if (inputs[i].value == "Male") {
                            lookingForMale = true;
                        }
                    }
                }

                var url = `https://us-central1-umtuwam.cloudfunctions.net/signUp?` +
                `name=${myName.value}` +
                `&gender=${gender}` +
                `&lookingFOrFemale=${lookingForFemale}` +
                `&lookingForMale=${lookingForMale}` +
                `&age=${age.value}` +
                `&location=${location.value}` +
                `&id=${id.value}`;

                fetch(url).then(function (response) {
                    return response.json();
                    // TODO: add redirect
                }).catch((error) => {
                    console.error('Error:', error);
                });;
            }
        }
    </script>
    <form onsubmit="stop();" method="get">
        <div>
            <img class="logo" src="./logo.png" alt="UmtuWam">
            <h2 class="h">Lets start dating!</h2>
            <div class="container">
                <p>
                    <label>My name is:
                        <br />
                        <input type="text" id="myName" name="myName" pattern="^([A-Za-z]+[,.]?[ ]?|[A-Za-z]+['-]?)+$"
                            maxlength="50" required>
                    </label>
                </p>
                <p>
                    <label>I am a:
                        <br />
                        <input id="Ifemale" type="radio" name="gender" value="Female" required>
                        <label for="Ifemale">Woman</label>
                        <input id="Imale" type="radio" name="gender" value="Male">
                        <label for="Imale">Man</label>
                    </label>
                </p>
                <p>
                    <label>Looking for a:
                        <br />
                        <input id="Ufemale" type="checkbox" name="lookingFor" value="Female">
                        <label for="Ufemale">Woman</label>
                        <input id="Umale" type="checkbox" name="lookingFor" value="Male">
                        <label for="Umale">Man</label>
                    </label>
                <p id="lookingForError" hidden style="color: red;">Please select at least one checkbox</p>
                </p>
                <p>
                    <label>My age:
                        <input type="text" id="age" name="age" class="age" pattern="[0-9]+" maxlength="3" required>
                    </label>
                </p>
                <p>
                    <label>My location:
                        <select name="location" id="location" required>
                            <option value="" disabled selected>Select your location</option>
                            <option value="Bloemfontein">Bloemfontein</option>
                            <option value="Cape Town">Cape Town</option>
                            <option value="Durban">Durban</option>
                            <option value="Johannesburg">Johannesburg</option>
                            <option value="Kimberley">Kimberley</option>
                            <option value="Nelspruit">Nelspruit</option>
                            <option value="PE">PE</option>
                            <option value="Polokwane">Polokwane</option>
                            <option value="Pretoria">Pretoria</option>
                            <option value="Soweto">Soweto</option>
                        </select>
                    </label>
                </p>
                <input type="text" id="id" name="id" hidden value= />
            </div>
            <button type="submit" id="checkBtn">Start dating</button>
        </div>
    </form>
</body>

</html>
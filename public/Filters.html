<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>UmtuWam</title>
    <link rel="stylesheet" href="./Filters.css" type="text/css">
</head>

<body>
    <script>
        window.onload = function () {
            id.setAttribute("value", new URL(location.href).searchParams.get("did"));
            fetch(`https://us-central1-umtuwam.cloudfunctions.net/getUserPreferences?id=${id.value}`)
                .then(res => res.json())
                .then((out) => {
                    if (out.gender == "Female") {
                        female.setAttribute("checked", true)
                    } else {
                        male.setAttribute("checked", true)
                    }

                    ageFrom.setAttribute("value", out.ageMin);
                    ageTo.setAttribute("value", out.ageMax);

                    var location = document.getElementById("location").children;
                    for (var i = 0; i < location.length; i++) {
                        if (location[i].value == out.location) {
                            location[i].selected = true;
                            break;
                        }
                    }
                }).catch(err => console.error(err));
        }

        function stop() {
            event.preventDefault();

            var lookingFor = "";
            var inputs = document.getElementsByName("lookingFor");
            for (var i = 0; i < inputs.length; i++) {
                if (inputs[i].checked) {
                    lookingFor = inputs[i].value;
                }
            }

            var url = `https://us-central1-umtuwam.cloudfunctions.net/updateUserPreferences?ageFrom=${ageFrom.value}&ageTo=${ageTo.value}&location=${location.value}&lookingFor=${lookingFor}&id=${id.value}`;

            fetch(url).then(function (response) {
                return response.json();
            }).catch(err => console.error(err));
        }

    </script>
    <form onsubmit="stop();" method="get">
        <img class="logo" src="./logo.png" alt="UmtuWam">
        <!-- <hr>
        <h2>Preferences:</h2>
        <hr> -->
        <div class="container">
            <p>
                <label>Ages:
                    <input class="age" type="text" id="ageFrom" name="ageMin" pattern="[0-9]+" maxlength="3" required>
                    <label for="ageTo">to:</label>
                    <input class="age" type="text" id="ageTo" name="ageMax" pattern="[0-9]+" maxlength="3" required>
                </label>
            </p>
            <p>
                <label>Looking for:
                    <input id="female" type="radio" name="lookingFor" value="Female" required>
                    <label for="female">Woman</label>
                    <input id="male" type="radio" name="lookingFor" value="Male">
                    <label for="male">Man</label>
                </label>
            <p id="error" hidden style="color: red;">Please select at least one checkbox</p>
            </p>
            <p>
                <label>Location:
                    <select name="location" id="location" required>
                        <option value="" disabled selected>Select your location</option>
                        <option value="Bloemfontein">Bloemfontein</option>
                        <option value="Cape Town">Cape Town</option>
                        <option value="Durban">Durban</option>
                        <option value="Johannesburg">Johannesburg</option>
                        <option value="Kimberley">Kimberley</option>
                        <option value="Nelspruit">Nelspruit</option>
                        <option value="PE">PE</option>
                        <option value="Polokwane">Polokwane</option>
                        <option value="Pretoria">Pretoria</option>
                        <option value="Soweto">Soweto</option>
                    </select>
                </label>
            </p>
            <input type="text" id="id" name="id" hidden value= />
        </div>
        <button type="submit">Save Changes</button>
    </form>
</body>

</html>